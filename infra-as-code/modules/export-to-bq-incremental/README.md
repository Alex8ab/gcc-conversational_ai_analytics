

## Create the CCAI tables
The CCAI Insights export process has a limit of 100000 conversations per export. This is why we need to implement an incremental load process.
We will be working with 2 tables: 
- `export_staging`: this table will contain the new conversations generated since the last load
- `export`: this table will contain the full history of conversations.

The `export_staging` table can be generated by creating an empty table in BigQuery and manually running the Export process from the CCAI Insights console. This will generate the table schema of the `export_staging` table.

Now that we have the `export_staging` table, we can create the `export` table by running the following DDL in BigQuery:

```sql
CREATE TABLE mydataset.export
LIKE mydataset.export_staging
```

As new fields may have been added over time as part of the schema evolution of CCAI Insights, we need to make sure the 'merge query' available in `function-source-code/lib.py` matches the schema of the `export` table.

## Add clustering to the export table
```sh
gcloud config set project <your-project-id>
bq update --clustering_fields=conversationName mydataset.export
```